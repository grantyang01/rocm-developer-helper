{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [
        {
            "type": "bashdb",
            "request": "launch",
            "name": "Bash-Debug (shisa)",
            "program": "${file}",
            "cwd": "${workspaceFolder}/test",
            "args": [
                // "-s"
                //"-p", "."
            ],
        },
        
        {
            "name": "(rocgdb) Launch - gemm_test",
            "type": "cppdbg",
            "request": "launch",
            "program": "/home/gryang/work/shisa/binDebug/gemm_test",
            "args": [
                // Shader options:
                // "--shader_path", "/home/gryang/work/shisa/app_study/hipblaslt_gemm_tf32/case1_all.elf",  // All gfx architectures
                "--shader_path", "/home/gryang/work/shisa/app_study/hipblaslt_gemm_tf32/case1_tn.s",  // hipBLASLt kernel (StreamK, needs CBDATA_hipblaslt)
                //"--shader_path", "/home/gryang/work/shisa/app_study/hipblaslt_gemm_tf32/case1.elf",  // built by shader_build  from case1.s, same as case1.elf 
                // "--shader_path", "/home/gryang/work/shisa/shader_dev_SSP/shaders/GEMM/gemm_f32_bf16.ssp",  // Human-written SSP (traditional tiled GEMM)
                "--interface", "hipblaslt",
                "-M", "2048",
                "-N", "8192",
                "-K", "5640",
                "--n_groups", "256",
                "--alpha", "1.0",
                "--beta", "0.0",
                "--a_col", "0",    // A: row-major = A^T in col-major view
                "--b_col", "1",    // B: col-major = B in col-major view
                "--cd_col", "1",   // C/D: col-major (required for hipBLASLt)
                "--pattern", "12300",  // Serial along M dim (easier to debug strides)
                // "--pattern", "1004",   // Bit-exact pattern
                "--check", "1",        // Enable correctness validation
                "--repeat", "1",
                // For performance testing (matching case1_tn.yaml):
                // "--buffer_rotate", "1",     // 1 GB buffer rotation (case1_tn.yaml uses 512 MB)
                // "--repeat", "1049",         // Match case1_tn.yaml iters
                // "--pattern", "4",           // trig_float initialization (match case1_tn.yaml)
                // NOTE: case1.s requires hipBLASLt CBDATA (184 bytes, 38 fields)
                //       workspace: 64MB, flags: 16MB (or 1-byte dummy buffers)
            ],
            "stopAtEntry": true,
            "cwd": "/home/gryang/work/shisa/binDebug",
            "environment": [
                {
                    "name": "LD_LIBRARY_PATH",
                    "value": "/SHISA/binDebug:/SHISA/bin:/opt/rocm/lib/llvm/lib"
                },
                {
                    "name": "PATH",
                    "value": "/SHISA/bin:/opt/rocm-7.2.0/bin:/opt/rocm-7.2.0/lib/llvm/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:${env:PATH}"
                },
                {
                    "name": "DEBIAN_FRONTEND",
                    "value": "noninteractive"
                },
                {
                    "name": "ROCM_VERSION",
                    "value": "7.2.0"
                },
                {
                    "name": "ROCM_PATH",
                    "value": "/opt/rocm-7.2.0"
                },
                {
                    "name": "ROCM_ROOT",
                    "value": "/opt/rocm-7.2.0"
                },
                {
                    "name": "CMAKE_PREFIX_PATH",
                    "value": "/opt/rocm-7.2.0"
                },
                {
                    "name": "HOME",
                    "value": "/home/gryang"
                },
                {
                    "name": "CC",
                    "value": "/opt/rocm/llvm/bin/clang"
                },
                {
                    "name": "CXX",
                    "value": "/opt/rocm/llvm/bin/clang++"
                },
                {
                    "name": "SHISA",
                    "value": "/SHISA"
                },
                {
                    "name": "SP3_ASIC",
                    "value": "MI350"
                },
                {
                    "name": "SP3_PREPROCESSOR",
                    "value": "perl /SHISA/tools/scripts/preprocessor.pl"
                },
                {
                    "name": "SP3_PREPROCESSOR_INCLUDE_DIRS",
                    "value": "/SHISA/shader_dev_SSP/include;/SHISA/shader_dev_IL/include;/SHISA/shader_dev/include/lib"
                },
                {
                    "name": "SP3_PREPROCESSOR_CONFIG_FILE",
                    "value": "/SHISA/sp3_config.log"
                },
                {
                    "name": "SHISA_CLANG_BINARY",
                    "value": "/opt/rocm/llvm/bin/clang"
                },
                {
                    "name": "SHISA_ELF_ABI",
                    "value": "HSA"
                },
                {
                    "name": "TT_OPTS",
                    "value": "-a GFX9"
                },                
            ],
            "externalConsole": false,
            "MIMode": "gdb",
            "miDebuggerPath": "/opt/rocm/bin/rocgdb"
        },
        
        {
            "name": "(gdb) Launch - hipblaslt-bench",
            "type": "cppdbg",
            "request": "launch",
            
            "program": "/home/gryang/work/rocm-libraries/projects/hipblaslt/build/debug/clients/hipblaslt-bench",
            "args": [
                "--yaml",
                "/home/gryang/work/shisa/app_study/hipblaslt_gemm_tf32/case1.yaml"
            ],
            
            "environment": [
                {
                    "name": "PATH",
                    "value": "/SHISA/bin:/opt/rocm-7.2.0/bin:/opt/rocm-7.2.0/lib/llvm/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:${env:PATH}"
                },
                {
                    "name": "DEBIAN_FRONTEND",
                    "value": "noninteractive"
                },
                {
                    "name": "ROCM_VERSION",
                    "value": "7.2.0"
                },
                {
                    "name": "ROCM_PATH",
                    "value": "/opt/rocm-7.2.0"
                },
                {
                    "name": "ROCM_ROOT",
                    "value": "/opt/rocm-7.2.0"
                },
                {
                    "name": "CMAKE_PREFIX_PATH",
                    "value": "/opt/rocm-7.2.0"
                },
                {
                    "name": "HOME",
                    "value": "/home/gryang"
                },
                {
                    "name": "CC",
                    "value": "/opt/rocm/llvm/bin/clang"
                },
                {
                    "name": "CXX",
                    "value": "/opt/rocm/llvm/bin/clang++"
                },
                {
                    "name": "SHISA",
                    "value": "/SHISA"
                },
                {
                    "name": "LD_LIBRARY_PATH",
                    "value": "/SHISA/bin:/opt/rocm/lib/llvm/lib"
                },
                {
                    "name": "SP3_ASIC",
                    "value": "MI350"
                },
                {
                    "name": "SP3_PREPROCESSOR",
                    "value": "perl /SHISA/tools/scripts/preprocessor.pl"
                },
                {
                    "name": "SP3_PREPROCESSOR_INCLUDE_DIRS",
                    "value": "/SHISA/shader_dev_SSP/include;/SHISA/shader_dev_IL/include;/SHISA/shader_dev/include/lib"
                },
                {
                    "name": "SP3_PREPROCESSOR_CONFIG_FILE",
                    "value": "/SHISA/sp3_config.log"
                },
                {
                    "name": "SHISA_CLANG_BINARY",
                    "value": "/opt/rocm/llvm/bin/clang"
                },
                {
                    "name": "SHISA_ELF_ABI",
                    "value": "HSA"
                },
                {
                    "name": "TT_OPTS",
                    "value": "-a GFX9"
                },                
            ],
            "stopAtEntry": true,
            "cwd": "/home/gryang/work/",
            "externalConsole": false,
            "MIMode": "gdb",
            "miDebuggerPath": "/usr/bin/rocgdb",
            "setupCommands": [
                {
                    "description": "Enable pretty-printing for gdb",
                    "text": "-enable-pretty-printing",
                    "ignoreFailures": true
                },
                {
                    "description": "Set Disassembly Flavor to Intel",
                    "text": "-gdb-set disassembly-flavor intel",
                    "ignoreFailures": true
                },
                {
                    "description": "Enable GDB demangling",
                    "text": "set print demangle on",
                    "ignoreFailures": true
                },
                {
                    "description": "Set print pretty on",
                    "text": "set print pretty on",
                    "ignoreFailures": true
                }            
            ]
        },

        {
            "name": "(gdb) Launch - rocsolver-bench",
            "type": "cppdbg",
            "request": "launch",

            // orgin command:
            // rocsolver-bench -f syevd -n 8192 --evect V --iters 1 --perf 1 -r s
            "program": "/home/gryang/work/solver/rocsolver/build/debug/clients/staging/rocsolver-bench",
            "args": [
                "-f","syevd",
                // "-n","8192",
                "-n","1024",
                "--evect","V",
                "--iters","1",
                "--perf","1",
                "-r","s"
            ],

            "environment": [
            ],

            "stopAtEntry": true,
            "cwd": "/home/gryang/work/",
            "externalConsole": false,
            "MIMode": "gdb",
            "miDebuggerPath": "/usr/bin/rocgdb",
            "setupCommands": [
                {
                    "description": "Enable pretty-printing for gdb",
                    "text": "-enable-pretty-printing",
                    "ignoreFailures": true
                },
                {
                    "description": "Set Disassembly Flavor to Intel",
                    "text": "-gdb-set disassembly-flavor intel",
                    "ignoreFailures": true
                },
                {
                    "description": "Enable GDB demangling",
                    "text": "set print demangle on",
                    "ignoreFailures": true
                }
            ],
        },


        {
            "name": "(gdb) Launch - misa_conv_test",
            "type": "cppdbg",
            "request": "launch",

            // orgin command:
            // /SHISA/bin/misa_conv_test --interface misa --run_conv_from_dump 1 -k1 -t1004  --device 0 --misasp3 /home/gryang/work/misa/workdir-fix_wrw_applicability/misa_new_sp3/ --dir bwd --type fp32 --argdump /home/gryang/work/misa/workdir-fix_wrw_applicability/results_partial/dump_dir/dump0001/igemm_bwd_gtcx35_nhwc_fp32_bx0_ex1_bt128x64x8_wt32x32x2_ws1x1_wr2x1_ta1x1x4x1_1x8x1x32_tb1x1x2x1_1x8x1x32_mh_me_gkgs.gks1.dump  -n 500 --ms_limit -1
            "program": "/SHISA/binDebug/misa_conv_test",
            "args": [
                "--interface","misa",
                "--run_conv_from_dump","1",
                "-k1",
                "-t1004",
                "--device","0",
                "--misasp3","/home/gryang/work/misa/workdir-fix_wrw_applicability/misa_new_sp3/",
                "--dir","bwd",
                "--type","fp32",
                "--argdump","/home/gryang/work/misa/workdir-fix_wrw_applicability/results_partial/dump_dir/dump0001/igemm_bwd_gtcx35_nhwc_fp32_bx0_ex1_bt128x64x8_wt32x32x2_ws1x1_wr2x1_ta1x1x4x1_1x8x1x32_tb1x1x2x1_1x8x1x32_mh_me_gkgs.gks1.dump",
                "-n","100",
                "--ms_limit", "-1"
            ],

            "environment": [
                {
                    "name": "LD_LIBRARY_PATH",
                    "value": "/SHISA/binDebug:/SHISA/bin:/opt/rocm/lib/llvm/lib"
                },

                {
                    "name": "SHISA_HSA_PM4_MODE",
                    "value": "1"
                },
                
                {
                    "name": "SHISA_HSA_TIMEOUT_SECONDS",
                    "value": "1"
                },
            ],

            "stopAtEntry": true,
            "cwd": "/home/gryang/work/misa/workdir-fix_wrw_applicability/test/",
            "externalConsole": false,
            "MIMode": "gdb",
            "miDebuggerPath": "/usr/bin/rocgdb",
            "setupCommands": [
                {
                    "description": "Enable pretty-printing for gdb",
                    "text": "-enable-pretty-printing",
                    "ignoreFailures": true
                },
                {
                    "description": "Set Disassembly Flavor to Intel",
                    "text": "-gdb-set disassembly-flavor intel",
                    "ignoreFailures": true
                }
            ]
        },

        // ShaderProcessor-exe - -asic MI350  -emit sp3
        {
            "name": "(gdb) Launch - shader_build",
            "type": "cppdbg",
            "request": "launch",

            // shader_build error.ssp -a MI350 --elf-abi HSA --elf-out error.elf
            "program": "/SHISA/binDebug/shader_build",
            "args": [
                "error.ssp",
                "-a","MI350",
                "--elf-abi","HSA",
                "--elf-out","error.elf",
                "--asm-out","error.sp3",
                "--log-out","error.log"
            ],

            "environment": [
                {
                    "name": "LD_LIBRARY_PATH",
                    "value": "/SHISA/binDebug:/SHISA/bin:/opt/rocm/lib/llvm/lib"
                }
            ],

            "stopAtEntry": true,
            "cwd": "/home/gryang/work/misa/workdir-fix_wrw_applicability/test/",
            "externalConsole": false,
            "MIMode": "gdb",
            "miDebuggerPath": "/usr/bin/rocgdb",
            "setupCommands": [
                {
                    "description": "Enable pretty-printing for gdb",
                    "text": "-enable-pretty-printing",
                    "ignoreFailures": true
                },
                {
                    "description": "Set Disassembly Flavor to Intel",
                    "text": "-gdb-set disassembly-flavor intel",
                    "ignoreFailures": true
                }
            ]
        },

        // path /home/gryang/work/misa/workdir-fix_wrw_applicability/misa_new/wrw_bf16
        // IGEMM_DUMPDIR_ALL=/tmp/DUMPbVh973 ./conv_driver.exe convbfp16 -F 4 -V 0 -t 1 --in_layout NHWC --fil_layout NHWC --out_layout NHWC -m conv --conv_stride_h 1 --conv_stride_w 1 --dilation_h 2 --dilation_w 2 --pad_h 0 --pad_w 1 -H 32 -W 32 -c 2 -k 64 -n 32 -x 3 -y 3
        {
            "name": "(gdb) Launch - conv_driver",
            "type": "cppdbg",
            "request": "launch",
            "program": "/home/gryang/work/misa/workdir-fix_wrw_applicability/misa_new/wrw_bf16/conv_driver.exe",
            "args": [
                "convbfp16",
                "-F","4",
                "-V","0",
                "-t","1",
                "--in_layout","NHWC",
                "--fil_layout","NHWC",
                "--out_layout","NHWC",
                "-m","conv",
                "--conv_stride_h","1",
                "--conv_stride_w","1",
                "--dilation_h","2",
                "--dilation_w","2",
                "--pad_h","0",
                "--pad_w","1",
                "-H","32",
                "-W","32",
                "-c","2",
                "-k","64",
                "-n","32",
                "-x","3",
                "-y","3"
            ],

            "environment": [
                {
                    "name": "LD_LIBRARY_PATH",
                    "value": "/SHISA/binDebug:/SHISA/bin:/opt/rocm/lib/llvm/lib"
                },
                {
                    "name": "IGEMM_DUMPDIR_ALL",
                    "value": "/tmp/DUMPbVh973"
                }
            ],

            "stopAtEntry": true,
            "cwd": "/home/gryang/work/misa/workdir-fix_wrw_applicability/misa_new/wrw_bf16/",
            "externalConsole": false,
            "MIMode": "gdb",
            "miDebuggerPath": "/usr/bin/rocgdb",
            "setupCommands": [
                {
                    "description": "Enable pretty-printing for gdb",
                    "text": "-enable-pretty-printing",
                    "ignoreFailures": true
                },
                {
                    "description": "Set Disassembly Flavor to Intel",
                    "text": "-gdb-set disassembly-flavor intel",
                    "ignoreFailures": true
                }
            ]
        },

        {
            "type": "perl",
            "request": "launch",
            "name": "Perl-Debug - run_misa_cases",
            "program": "/home/gryang/work/il/SHISA_stg/test_apps/misa_conv_test/scripts/run_misa_cases.pl",
            "cwd": "/home/gryang/work/misa",
            "stopOnEntry": true,
            "reloadModules": true,
            "args": [
                "-v",
                "-misa","/home/gryang/work/misa/workdir-fix_wrw_applicability/misa_new/",
                "-o","/home/gryang/work/misa/workdir-fix_wrw_applicability/results_base/res_page_wrw_bf16_part_004_misa_cases_random1k.txt",
                "-lr","/SHISA/ref_cache",
                "-sr","/SHISA/ref_cache",
                "--","/home/gryang/work/il/SHISA_stg/testing/misa_test/part_004_misa_cases_random1k.txt",
                "-k1",
                "-t1004",
                "--device","0",
                "--misasp3","/home/gryang/work/misa/workdir-fix_wrw_applicability/misa_new_sp3/",
                "--dir","wrw",
                "--type","bf16",
                "--dbg_force_alloc_granularity_misa","2097152",
                "--dbg","0"
            ]
        },
    ]
}